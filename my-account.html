<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300;500;700&display=swap">
    <link rel="stylesheet" href="./base-styles.css">
    <link rel="stylesheet" href="./components/NavBar/NavBar.css">
    <link rel="stylesheet" href="./components/form-vertical.css">
    <link rel="stylesheet" href="./components/btn.css">
    <link rel="shortcut icon" href="./assets/logos/favicon_yard_sale.svg" type="image/x-icon">
    <script type="module" src="./components/NavBar/NavBar.js"></script>
    <title>Yard Sale</title>
</head>
<body>
    <nav-bar></nav-bar>
    
    <main class="container container-flex-center--md container-sm--md">
        
        <form class="form-vertical" readonly>
            <h1 class="title-h1 mb-4">My account</h1>

            <label class="form-vertical__label">
                Name
                <textarea type="text" id="name" class="form-vertical__input" 
                    placeholder="Enter name" maxlength="80" required readonly></textarea>
            </label>

            <label class="form-vertical__label">
                Email address
                <input type="email" id="email" class="form-vertical__input" 
                    placeholder="example@example.com" maxlength="80" required readonly>
            </label>

            <div id="password">
                <label class="form-vertical__label">
                    Password
                </label>
                <a id="passwordLink" href="./create-new-password.html" class="link">Change password</a>
            </div>
    
            <button type="button" id="editBtn" class="btn btn--outline-primary fixed-bottom fixed-bottom-reset--md my-3">
                Edit
            </button>

            <button type="submit" id="saveBtn" class="d-none btn btn--primary fixed-bottom fixed-bottom-reset--md my-3">
                Save
            </button>
        </form>
        
    </main>

    <script>
        const form = document.querySelector('form'),
            nameInput = document.getElementById('name'),
            emailInput = document.getElementById('email'),
            passwordSection = document.getElementById('password'),
            editBtn = document.getElementById('editBtn'),
            saveBtn = document.getElementById('saveBtn');

        const init = () => {
            let user = JSON.parse(localStorage.getItem('yardSaleUser')) ?? { name:"John Doe", email: 'john.doe@email.com' };
            
            nameInput.value = user.name;
            emailInput.value = user.email;
        }
        
        init();
        
        const enableEdition = () => {
            [form, nameInput, emailInput].forEach(e => e.removeAttribute('readonly'));
            
            passwordSection.classList.add('d-none');
            editBtn.classList.add('d-none');
            saveBtn.classList.remove('d-none');
        }
        
        const saveChanges = (event) => {
            event.preventDefault();
            
            localStorage.setItem('yardSaleUser',JSON.stringify({
                name: nameInput.value,
                email: emailInput.value
            }));

            [form, nameInput, emailInput].forEach(e => e.setAttribute('readonly', true));
            
            [passwordSection, editBtn, saveBtn].forEach(e => e.classList.toggle('d-none'));
        }

        editBtn.addEventListener('click', enableEdition);
        form.addEventListener('submit', saveChanges);
    </script>
</body>
</html>